
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Sudix's Blog</title>
	<meta name="author" content="sudix">

	
	<meta name="description" content="2013/08/23 [Coffeescript] 標準偏差を使って異常っぽい値を検知してみる 日々変わる数字があって、たまに異常に減ったり増えたりする場合があり、
それが起きたときにすぐわかるようにしたい。
という要望があったので、標準偏差を使ってエラーっぽい値が分かるようにしてみました。 &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="Sudix's Blog" type="application/atom+xml">
	
	<link rel="canonical" href="http://sudix.github.io/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">
        <script src="/javascripts/md5.js"></script>
        <script type="text/javascript">
                $(function(){
                        $('.profilepic').append("<img src='http://www.gravatar.com/avatar/" + MD5("sudix7755@gmail.com") + "?s=160' alt='Profile Picture' style='width: 160px;' />");
                });
        </script>
</div>
<hgroup>
  <h1><a href="/">Sudix's Blog</a></h1>
  
    <h2>about pgoramming, It, etc...</h2>
  
</hgroup>

<p class="subtitle">about pgoramming, It, etc...</p>
<nav id="main-nav"><ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
<nav id="sub-nav">
        <div class="social">
                
                
                
                <a class="twitter" href="http://twitter.com/sudix" title="Twitter">Twitter</a>
                
                
                <a class="github" href="https://github.com/sudix" title="GitHub">GitHub</a>
                
                
                
                
                
                
                
                
                <a class="rss" href="/atom.xml" title="RSS">RSS</a>
                
        </div>
</nav>
</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner">
<div itemscope itemtype="http://schema.org/Blog">


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
        <div class="meta">
                <div class="date">








  


<time datetime="2013-08-23T11:02:00+09:00" data-updated="true" itemprop="datePublished">2013/08/23</time></div>
                <div class="tags">

</div>
                
        </div>
        <h1 class="title" itemprop="name"><a href="/blog/2013/08/23/error-detect-with-standard-deviation/" itemprop="url">[Coffeescript] 標準偏差を使って異常っぽい値を検知してみる</a></h1>
        <div class="entry-content" itemprop="articleBody">
                <p>日々変わる数字があって、たまに異常に減ったり増えたりする場合があり、
それが起きたときにすぐわかるようにしたい。
という要望があったので、標準偏差を使ってエラーっぽい値が分かるようにしてみました。
ブラウザ上で実行する必要があったのでcoffeescriptです。</p>

<h2>コード</h2>

<p>checkRangeListメソッドにデータを与えると、下限以下なら-1、上限以上なら1を返します。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="c1">######################</span>
</span><span class='line'><span class="c1"># 異常値計算用クラス</span>
</span><span class='line'><span class="c1">######################</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nx">ErrorDataDetector</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">self = </span><span class="kc">undefined</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># 平均からどれぐらい離れたら異常とみなすかの定数。</span>
</span><span class='line'>  <span class="c1"># ±（この値×標準偏差）から外れていれば異常とします。</span>
</span><span class='line'>  <span class="c1"># 2であればおよそ95%範囲の外の値になります。</span>
</span><span class='line'>  <span class="nv">normalRange = </span><span class="mi">2</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">constructor: </span><span class="nf">-&gt;</span> <span class="nv">self = </span><span class="k">this</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">#平均を求める</span>
</span><span class='line'>  <span class="nv">average: </span><span class="nf">(data) -&gt;</span>
</span><span class='line'>    <span class="nx">data</span><span class="p">.</span><span class="nx">reduce</span><span class="p">(</span><span class="nf">(acc, n) -&gt;</span> <span class="nx">acc</span> <span class="o">+</span> <span class="nx">n</span><span class="p">)</span> <span class="o">/</span> <span class="nx">data</span><span class="p">.</span><span class="nx">length</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">#分散を求める</span>
</span><span class='line'>  <span class="c1">#((データ－平均値)の２乗)の総和÷ 個数</span>
</span><span class='line'>  <span class="nv">variance: </span><span class="nf">(data, avg) -&gt;</span>
</span><span class='line'>    <span class="nx">data</span><span class="p">.</span><span class="nx">reduce</span><span class="p">(</span><span class="nf">(acc, n) -&gt;</span> <span class="nx">acc</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">n</span> <span class="o">-</span> <span class="nx">avg</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="nx">data</span><span class="p">.</span><span class="nx">length</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">#標準偏差を求める</span>
</span><span class='line'>  <span class="c1">#分散の平方根</span>
</span><span class='line'>  <span class="nv">standardDeviation: </span><span class="nf">(data, avg) -&gt;</span>
</span><span class='line'>    <span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">variance</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">avg</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">#外れ値かどうかを調べ、リストに結果を詰めて返す</span>
</span><span class='line'>  <span class="c1">#-1:範囲外(下) 0:正常 1:範囲外(上)</span>
</span><span class='line'>  <span class="nv">checkRangeList: </span><span class="nf">(data) -&gt;</span>
</span><span class='line'>    <span class="nv">avg = </span><span class="nx">self</span><span class="p">.</span><span class="nx">average</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
</span><span class='line'>    <span class="nv">sd = </span><span class="nx">self</span><span class="p">.</span><span class="nx">standardDeviation</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">avg</span><span class="p">)</span>
</span><span class='line'>    <span class="nv">lb = </span><span class="nx">self</span><span class="p">.</span><span class="nx">lowerBound</span><span class="p">(</span><span class="nx">avg</span><span class="p">,</span> <span class="nx">sd</span><span class="p">)</span>
</span><span class='line'>    <span class="nv">ub = </span><span class="nx">self</span><span class="p">.</span><span class="nx">upperBound</span><span class="p">(</span><span class="nx">avg</span><span class="p">,</span> <span class="nx">sd</span><span class="p">)</span>
</span><span class='line'>    <span class="nx">data</span><span class="p">.</span><span class="nx">map</span> <span class="nf">(n) -&gt;</span> <span class="nx">self</span><span class="p">.</span><span class="nx">checkRange</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span> <span class="nx">avg</span><span class="p">,</span> <span class="nx">lb</span><span class="p">,</span> <span class="nx">ub</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># 下限境界</span>
</span><span class='line'>  <span class="nv">lowerBound: </span><span class="nf">(avg, sd) -&gt;</span> <span class="nx">avg</span> <span class="o">-</span> <span class="p">(</span><span class="nx">sd</span> <span class="o">*</span> <span class="nx">normalRange</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># 上限境界</span>
</span><span class='line'>  <span class="nv">upperBound: </span><span class="nf">(avg, sd) -&gt;</span> <span class="nx">avg</span> <span class="o">+</span> <span class="p">(</span><span class="nx">sd</span> <span class="o">*</span> <span class="nx">normalRange</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">checkRange: </span><span class="nf">(n, avg, lb, ub) -&gt;</span>
</span><span class='line'>    <span class="k">if</span> <span class="nx">avg</span> <span class="o">==</span> <span class="mi">0</span>
</span><span class='line'>      <span class="mi">0</span>
</span><span class='line'>    <span class="k">else</span> <span class="k">if</span> <span class="nx">n</span> <span class="o">&lt;=</span> <span class="nx">lb</span>
</span><span class='line'>      <span class="o">-</span><span class="mi">1</span>
</span><span class='line'>    <span class="k">else</span> <span class="k">if</span> <span class="nx">n</span> <span class="o">&gt;=</span> <span class="nx">ub</span>
</span><span class='line'>      <span class="mi">1</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>      <span class="mi">0</span>
</span></code></pre></td></tr></table></div></figure>


<h2>実行結果</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nv">l = </span><span class="p">[</span><span class="mi">826</span><span class="p">,</span><span class="mi">751</span><span class="p">,</span><span class="mi">833</span><span class="p">,</span><span class="mi">905</span><span class="p">,</span><span class="mi">888</span><span class="p">,</span><span class="mi">950</span><span class="p">,</span><span class="mi">880</span><span class="p">,</span><span class="mi">868</span><span class="p">,</span><span class="mi">935</span><span class="p">,</span><span class="mi">1293</span><span class="p">,</span><span class="mi">1315</span><span class="p">,</span><span class="mi">1555</span><span class="p">,</span><span class="mi">1445</span><span class="p">,</span><span class="mi">1732</span><span class="p">,</span><span class="mi">1351</span><span class="p">,</span><span class="mi">1157</span><span class="p">,</span><span class="mi">1268</span><span class="p">,</span><span class="mi">1201</span><span class="p">,</span><span class="mi">733</span><span class="p">,</span><span class="mi">2000</span><span class="p">,</span><span class="mi">100</span><span class="p">]</span>
</span><span class='line'><span class="nv">d = </span><span class="k">new</span> <span class="nx">ErrorDataDetector</span><span class="p">()</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">checkRangeList</span><span class="p">(</span><span class="nx">l</span><span class="p">))</span>
</span><span class='line'> <span class="c1"># 結果 =&gt;　[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, -1]</span>
</span></code></pre></td></tr></table></div></figure>


<h2>オチ</h2>

<p>さっそく実装して試したところ異常っぽい値を検知できたので意気揚々と担当者に見せたところ、
よくわかんないからもっと簡単なロジックにしてと言われましたとさ・・・。</p>

                
                
        </div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
        <div class="meta">
                <div class="date">








  


<time datetime="2013-08-20T12:26:00+09:00" data-updated="true" itemprop="datePublished">2013/08/20</time></div>
                <div class="tags">


	<a class='category' href='/blog/categories/scala/'>scala</a>


</div>
                
        </div>
        <h1 class="title" itemprop="name"><a href="/blog/2013/08/20/sieve-of-eratosthenes-with-scala/" itemprop="url">Scalaでエラトステネスの篩を実装してみる</a></h1>
        <div class="entry-content" itemprop="articleBody">
                <p>こちらのエントリ
<a href="http://udzura.hatenablog.jp/entry/2013/08/17/021446">もしぼくが採用するなら</a>
を読んで、エラトステネスの篩は知ってはいるものの実装してみたことないなぁと思い、
Scalaで実装してみました。</p>

<p><a href="http://ja.wikipedia.org/wiki/%E3%82%A8%E3%83%A9%E3%83%88%E3%82%B9%E3%83%86%E3%83%8D%E3%82%B9%E3%81%AE%E7%AF%A9">Wikipedia</a>の例題を参考に作ってみます。
考え方としては自然数の集合に対して、小さい順からその倍数を削除していって、
残ったものが素数、という考えです。</p>

<p>最初、こんな感じで実装してみました。</p>

<figure class='code'><figcaption><span>末尾再帰じゃないバージョン</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">def</span> <span class="n">sieveOfEratosthenes</span><span class="o">(</span><span class="n">numbers</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">])</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">numbers</span> <span class="k">match</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">case</span> <span class="nc">Nil</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="nc">Nil</span>
</span><span class='line'>    <span class="k">case</span> <span class="mi">1</span> <span class="o">::</span> <span class="n">tail</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="n">sieveOfEratosthenes</span><span class="o">(</span><span class="n">tail</span><span class="o">)</span>
</span><span class='line'>    <span class="k">case</span> <span class="n">head</span> <span class="o">::</span> <span class="n">tail</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="n">head</span> <span class="o">::</span> <span class="n">sieveOfEratosthenes</span><span class="o">(</span><span class="n">tail</span><span class="o">.</span><span class="n">filterNot</span><span class="o">(</span><span class="k">_</span> <span class="o">%</span> <span class="n">head</span> <span class="o">==</span> <span class="mi">0</span><span class="o">))</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 実行</span>
</span><span class='line'><span class="n">println</span><span class="o">(</span><span class="n">sieveOfEratosthenes</span><span class="o">(</span><span class="nc">Range</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">121</span><span class="o">).</span><span class="n">toList</span><span class="o">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>まあこれで動くには動くのですが、最後で再帰の結果に対して演算しているので末尾再帰されてません（@tailrecつけるとコンパイルエラーになる）。
なので数が多くなるとOutOfMemoryで落ちます。</p>

<p>いろいろ考えて、素数の結果リストを引数で渡すようにしました。</p>

<figure class='code'><figcaption><span>末尾再帰バージョン</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">import</span> <span class="nn">scala.annotation.tailrec</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@tailrec</span>
</span><span class='line'><span class="k">def</span> <span class="n">sieveOfEratosthenes</span><span class="o">(</span><span class="n">numbers</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">],</span> <span class="n">primes</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">])</span><span class="k">:</span> <span class="o">(</span><span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">],</span> <span class="nc">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">])</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">numbers</span> <span class="k">match</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">case</span> <span class="nc">Nil</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="o">(</span><span class="n">numbers</span><span class="o">,</span> <span class="n">primes</span><span class="o">.</span><span class="n">reverse</span><span class="o">)</span>
</span><span class='line'>    <span class="k">case</span> <span class="mi">1</span> <span class="o">::</span> <span class="n">tail</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="n">sieveOfEratosthenes</span><span class="o">(</span><span class="n">tail</span><span class="o">,</span> <span class="n">primes</span><span class="o">)</span>
</span><span class='line'>    <span class="k">case</span> <span class="n">head</span> <span class="o">::</span> <span class="n">tail</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="n">sieveOfEratosthenes</span><span class="o">(</span><span class="n">tail</span><span class="o">.</span><span class="n">filterNot</span><span class="o">(</span><span class="k">_</span> <span class="o">%</span> <span class="n">head</span> <span class="o">==</span> <span class="mi">0</span><span class="o">),</span> <span class="n">head</span> <span class="o">::</span> <span class="n">primes</span><span class="o">)</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 実行</span>
</span><span class='line'><span class="n">sieveOfEratosthenes</span><span class="o">(</span><span class="nc">Range</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">120</span><span class="o">).</span><span class="n">toList</span><span class="o">,</span> <span class="nc">Nil</span><span class="o">).</span><span class="n">_2</span>
</span></code></pre></td></tr></table></div></figure>


<p>末尾再帰になった！しかし実行時に引数にNilを渡したり、結果がタプルなので結果取得にひと手間かかったり、かっこ悪すぎ。<br/>
なので隠蔽を図った結果がこれ。</p>

<figure class='code'><figcaption><span>末尾再帰バージョン（呼び出しをシンプルに）</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">import</span> <span class="nn">scala.annotation.tailrec</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="n">sieveOfEratosthenes</span><span class="o">(</span><span class="n">numbers</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">])</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>  <span class="nd">@tailrec</span>
</span><span class='line'>  <span class="k">def</span> <span class="n">sieve</span><span class="o">(</span><span class="n">numbers</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">],</span> <span class="n">primes</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">])</span><span class="k">:</span> <span class="o">(</span><span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">],</span> <span class="nc">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">])</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">numbers</span> <span class="k">match</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">case</span> <span class="nc">Nil</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="o">(</span><span class="n">numbers</span><span class="o">,</span> <span class="n">primes</span><span class="o">.</span><span class="n">reverse</span><span class="o">)</span>
</span><span class='line'>      <span class="k">case</span> <span class="mi">1</span> <span class="o">::</span> <span class="n">tail</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="n">sieve</span><span class="o">(</span><span class="n">tail</span><span class="o">,</span> <span class="n">primes</span><span class="o">)</span>
</span><span class='line'>      <span class="k">case</span> <span class="n">head</span> <span class="o">::</span> <span class="n">tail</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="n">sieve</span><span class="o">(</span><span class="n">tail</span><span class="o">.</span><span class="n">filterNot</span><span class="o">(</span><span class="k">_</span> <span class="o">%</span> <span class="n">head</span> <span class="o">==</span> <span class="mi">0</span><span class="o">),</span> <span class="n">head</span> <span class="o">::</span> <span class="n">primes</span><span class="o">)</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  <span class="n">sieve</span><span class="o">(</span><span class="n">numbers</span><span class="o">,</span> <span class="nc">Nil</span><span class="o">).</span><span class="n">_2</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 実行</span>
</span><span class='line'><span class="n">println</span><span class="o">(</span><span class="n">sieveOfEratosthenes</span><span class="o">(</span><span class="nc">Range</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">121</span><span class="o">).</span><span class="n">toList</span><span class="o">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>できたけどなんかゴチャゴチャしてる感じがありますね・・・。きっともっと素敵な書き方があるはず。<br/>
ということでググってみると、<br/>
<a href="http://mogproject.blogspot.jp/2013/05/sieve-of-eratosthenes-in-scala.html">Sieve of Eratosthenes in Scala</a><br/>
こちらの記事を発見。おお、Stream使うとこんなにもスッキリ書けるんですね。確かに衝撃的。<br/>
まだまだScala力が足りません。</p>

                
                
        </div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
        <div class="meta">
                <div class="date">








  


<time datetime="2013-08-05T16:42:00+09:00" data-updated="true" itemprop="datePublished">2013/08/05</time></div>
                <div class="tags">


	<a class='category' href='/blog/categories/miscellaneous/'>miscellaneous</a>


</div>
                
        </div>
        <h1 class="title" itemprop="name"><a href="/blog/2013/08/05/move-to-octopress/" itemprop="url">OctopressとGitHub Pagesでブログを始めてみた</a></h1>
        <div class="entry-content" itemprop="articleBody">
                <p>これまではてなダイアリーを使ってきましたが、<br/>
octopressを知って面白そうだったので導入してみました。<br/>
「A blogging framework for hackers.」<br/>
とか言われたら使うしかないですよね。<br/>
導入も簡単だし、markdownで記事書けるし楽しそうなので、<br/>
しばらく使ってみます。</p>

<hr />

<h1>参考にさせていただいたサイト</h1>

<p><a href="http://onigra.github.io/blog/2013/04/28/introduction-of-octopress/">OctopressとGitHub Pagesを使用したブログの構築手順</a></p>

<p><a href="http://randd.kwappa.net/2013/04/16/521">Octopress で GitHub Pages を置き換える</a></p>

<hr />

<h1>環境</h1>

<ul>
<li>Ubuntu 13.04</li>
<li>Ruby 1.9.3</li>
</ul>


<hr />

<h1>Octpressの設定</h1>

<h2>Octopressをfork</h2>

<p>Octopressをダウンロードする前に、自分のリポジトリにforkしておくのをお勧めします。<br/>
いきなりcloneしてもいいのですが、forkしておけば変更後そのままpushすることで、<br/>
GitHub上でソースを管理することができます。<br/>
<a href="https://github.com/imathis/octopress">こちら</a>からforkしましょう。</p>

<h2>Octopressをダウンロード</h2>

<p>cloneするだけです。</p>

<figure class='code'><figcaption><span>Octopressのダウンロード</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>git clone git@github.com:sudix/octopress.git
</span></code></pre></td></tr></table></div></figure>


<h2>初期設定</h2>

<p>rubyのバージョン設定と、必要なgemのインストールを実行します。<br/>
rubyのバージョン設定は自分の環境に合わせて.rbenv-versionを書き換える事になります。<br/>
自分の環境だとubuntuのパッケージから入れたので「1.9.3-debian」となります。<br/>
これを設定しておかないと動きません。<br/>
また、gemのインストールはbundlerを使って、vendor/bundle以下にインストールしています。<br/>
参考：<a href="http://octopress.org/docs/setup/">http://octopress.org/docs/setup/</a></p>

<figure class='code'><figcaption><span>Octopressの初期設定</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span><span class="nb">cd </span>octopress
</span><span class='line'><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">&quot;1.9.3-debian&quot;</span> &gt; .rbenv-version
</span><span class='line'><span class="nv">$ </span>sudo gem install bundler
</span><span class='line'><span class="nv">$ </span>bundle install --path vendor/bundle
</span><span class='line'><span class="nv">$ </span>bundle <span class="nb">exec </span>rake install
</span></code></pre></td></tr></table></div></figure>


<h2>プレビュー</h2>

<p>以下のコマンドを実行します。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>bundle <span class="nb">exec </span>rake preview
</span></code></pre></td></tr></table></div></figure>


<p>これで次のURLでプレビューできるようになります。<br/>
<a href="http://localhost:4000/">http://localhost:4000/</a></p>

<h2>テーマ</h2>

<p>テーマの設定が可能です。以下からお好みのテーマを探してみてください。<br/>
<a href="https://github.com/imathis/octopress/wiki/3rd-Party-Octopress-Themes">3rd party themes</a></p>

<p>今回はこのテーマを使ってみます。<br/>
<a href="https://github.com/shashankmehta/greyshade">greyshade</a></p>

<figure class='code'><figcaption><span>テーマのインストール</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>git clone git@github.com:shashankmehta/greyshade.git .themes/greyshade
</span><span class='line'><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">&quot;\$greyshade: #073642;&quot;</span> &gt;&gt; sass/custom/_colors.scss //Substitue <span class="s1">&#39;color&#39;</span> with your highlight color
</span><span class='line'><span class="nv">$ </span>bundle <span class="nb">exec </span>rake <span class="s2">&quot;install[greyshade]&quot;</span>
</span><span class='line'><span class="nv">$ </span>bundle <span class="nb">exec </span>rake generate
</span><span class='line'><span class="nv">$ </span>bundle <span class="nb">exec </span>rake preview
</span></code></pre></td></tr></table></div></figure>


<h2>コンフィグ</h2>

<p>参考:<a href="http://octopress.org/docs/configuring/">http://octopress.org/docs/configuring/</a><br/>
_config.ymlを編集し、各種設定を行います。変更した箇所だけを抜粋しています。</p>

<figure class='code'><figcaption><span>_config.yml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">url</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">http://sudix.github.io</span>
</span><span class='line'><span class="l-Scalar-Plain">title</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Sudix Blog</span>
</span><span class='line'><span class="l-Scalar-Plain">subtitle</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">my blog about programming, IT, etc...</span>
</span><span class='line'><span class="l-Scalar-Plain">author</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">sudix</span>
</span><span class='line'><span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">about programming, IT, etc...</span>
</span><span class='line'><span class="l-Scalar-Plain">date_format</span><span class="p-Indicator">:</span> <span class="s">&quot;%Y/%m/%d&quot;</span>
</span><span class='line'><span class="l-Scalar-Plain">email</span><span class="p-Indicator">:</span> <span class="s">&quot;youremailaddress@example.com&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<hr />

<h1>Githubの設定</h1>

<h2>create repository</h2>

<p>手順:<a href="http://octopress.org/docs/deploying/github/">http://octopress.org/docs/deploying/github/</a></p>

<p>Github pages用のリポジトリを作っておく必要があります。<br/>
「自分のユーザー名.github.io」という名前のリポジトリになります。<br/>
自分の場合だと「sudix.github.io」ですね。<br/>
octopressの上記手順で説明のある.comではなく.ioで作る必要があるようです。<br/>
昔と変わったのでしょうか。<br/>
<a href="https://help.github.com/articles/user-organization-and-project-pages">Github Pagesのマニュアル</a></p>

<p>リポジトリ作成はこちらから。<a href="https://github.com/new">https://github.com/new</a></p>

<hr />

<h1>デプロイ＆公開</h1>

<p>いよいよ公開してみます。</p>

<h2>リポジトリの登録</h2>

<p>rake setup_github_pagesを実行するとRepository urlを入力しろと聞かれるので、<br/>
先ほど作ったリポジトリ（git@github.com:sudix/sudix.github.io）を入力します。</p>

<figure class='code'><figcaption><span>リポジトリの登録</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>bundle <span class="nb">exec </span>rake setup_github_pages
</span><span class='line'>Enter the <span class="nb">read</span>/write url <span class="k">for </span>your repository
</span><span class='line'><span class="o">(</span>For example, <span class="s1">&#39;git@github.com:your_username/your_username.github.io)</span>
</span><span class='line'><span class="s1">           or &#39;</span>https://github.com/your_username/your_username.github.io<span class="err">&#39;</span><span class="o">)</span>
</span><span class='line'>Repository url: git@github.com:sudix/sudix.github.io
</span><span class='line'>rm -rf _deploy
</span><span class='line'>mkdir _deploy
</span><span class='line'><span class="nb">cd </span>_deploy
</span><span class='line'>Initialized empty Git repository in /home/sudix/apps/octopress/_deploy/.git/
</span><span class='line'><span class="o">[</span>master <span class="o">(</span>root-commit<span class="o">)</span> 5a3c02f<span class="o">]</span> Octopress init
</span><span class='line'> 1 file changed, 1 insertion<span class="o">(</span>+<span class="o">)</span>
</span><span class='line'> create mode 100644 index.html
</span><span class='line'><span class="nb">cd</span> -
</span><span class='line'>---
</span><span class='line'><span class="c">## Now you can deploy to http://sudix.github.io/sudix with `rake deploy` ##</span>
</span></code></pre></td></tr></table></div></figure>


<h2>デプロイ</h2>

<p>以下のコマンドでデプロイされます。</p>

<figure class='code'><figcaption><span>デプロイ実行</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>bundle <span class="nb">exec </span>rake deploy
</span></code></pre></td></tr></table></div></figure>


<h3>公開されたか確認</h3>

<p>Github Pagesを開いてみて、公開されたか確認してみましょう。<br/>
なお、デプロイして10分ほど待つ必要があるみたいです。<br/>
<a href="http://sudix.github.io/">http://sudix.github.io/</a></p>

<hr />

<h1>コメント欄を追加</h1>

<p><a href="http://disqus.com/">DISQUS</a>を使って、コメント欄を追加することもできます。<br/>
<a href="http://disqus.com/">DISQUS</a>に登録するとshort nameが発行されるので、<br/>
それを_config.ymlに設定するだけです。</p>

<figure class='code'><figcaption><span>_config.yml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="c1"># Disqus Comments                                                                                                                       </span>
</span><span class='line'><span class="l-Scalar-Plain">disqus_short_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">sudixsblog</span>
</span><span class='line'><span class="l-Scalar-Plain">disqus_show_comment_count</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">false</span>
</span></code></pre></td></tr></table></div></figure>


<p>追加した後、generateし直せば、下にコメント欄が表示されるはずです。</p>

<hr />

<h1>記事を書く</h1>

<p>さっそく記事を書いてみましょう。
手順:<a href="http://octopress.org/docs/blogging/">http://octopress.org/docs/blogging/</a></p>

<h2>ファイル作成</h2>

<p>rakeでnew_postを実行すれば記事を記入するためのmarkdownファイルが作成されます。<br/>
new_postの後にタイトルを入力しましょう。<br/>
ここで指定したタイトルを使ってパーマネントリンクが作成されます。<br/>
タイトルは日本語不可のようです。</p>

<figure class='code'><figcaption><span>記事の作成</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nv">$ </span>rake new_post<span class="o">[</span><span class="s2">&quot;my first octopress article&quot;</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<h2>タイトルの編集</h2>

<p>作成されたファイルを開くと、先頭にyamlで記述された設定があるので、<br/>
タイトルを変更したい場合はその中のtitleを編集します。</p>

<figure class='code'><figcaption><span>./source/_posts/yyyy-mm-dd-my-first-octopress-article.markdown</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="nn">---</span>
</span><span class='line'><span class="l-Scalar-Plain">layout</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">page</span>
</span><span class='line'><span class="l-Scalar-Plain">title</span><span class="p-Indicator">:</span> <span class="s">&quot;Octopressでの初めての記事&quot;</span>
</span><span class='line'><span class="l-Scalar-Plain">date</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">2013-08-06 20:59</span>
</span><span class='line'><span class="l-Scalar-Plain">comments</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
</span><span class='line'><span class="l-Scalar-Plain">sharing</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
</span><span class='line'><span class="l-Scalar-Plain">footer</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">true</span>
</span><span class='line'><span class="nn">---</span>
</span></code></pre></td></tr></table></div></figure>


<h2>記事の編集と公開</h2>

<p>あとはmarkdown形式で記事を書き、generateとdeployを実行すれば、記事が公開されます。</p>

<h2>おまけ コードスニペットの書き方</h2>

<p>gist使ったり色々と書き方はあるみたいです。<br/>
参考:<a href="http://octopress.org/docs/blogging/code/">http://octopress.org/docs/blogging/code/</a><br/>
基本はバッククォートで囲みます。言語も指定可能です。</p>

<pre><code>```ruby Test.rb
def hoge
  puts "hogefuga"
  1 + 2
end
```
</code></pre>

<p>と書けば、以下のように。</p>

<figure class='code'><figcaption><span>Test.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">hoge</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="s2">&quot;hogefuga&quot;</span>
</span><span class='line'>  <span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Scalaだって</p>

<pre><code>```scala Hoge.scala
object Hoge {
  def main(args: Array[String]) {
    println("hoge")
  }
}
```
</code></pre>

<p>↓</p>

<figure class='code'><figcaption><span>Hoge.scala</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">object</span> <span class="nc">Hoge</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">def</span> <span class="n">main</span><span class="o">(</span><span class="n">args</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">println</span><span class="o">(</span><span class="s">&quot;hoge&quot;</span><span class="o">)</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>綺麗に表示されて楽しいですね！</p>

                
                
        </div>

</article>

</div>
<nav id="pagenavi">
    
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
			</div>
			<footer id="footer" class="inner"><p>
  Copyright &copy; 2013 - sudix -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a>
</footer>
			<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'sudixsblog';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-43018369-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>




		</div>
	</div>
</body>
</html>
